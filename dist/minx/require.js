!function(l){var o="..",u="/",r=0,i=1,c=2,d=3,h=null;"undefined"!=typeof module&&module.exports?l.SLASH=u=require("path").sep:h=document;var f={normalizePath:function(e){for(var t,n=e.split(u),r=[n[0]],a=1,s=n.length;a<s;a++)switch(t=n[a]){case".":break;case o:var i=r[r.length-1];"."===i||i===o?r.push(o):r.pop();break;default:r.push(t)}return r.join(u)},formatPath:function(e,t){var n=e;n="/"===u?n.split("\\").join(u):n.split("/").join(u);var r=t&&t.get("path")||l.PATH,a=n.indexOf(u);return-1<n.indexOf(l.PATH)||-1<n.indexOf(l.ZN_PATH)?n:((n=0<a?r?r.substring(0,r.lastIndexOf(u)+1)+n:n:0===a?l.PATH.substring(0,l.PATH.lastIndexOf(u))+n:l.ZN_PATH+u+n+u).slice(-1)===u&&(n+="index.js"),n=this.normalizePath(n))}},p=l.Class("zn.Module",{events:["pending","loading","waiting","loaded"],statics:{all:{},current:null,counter:0,preLoadedPackage:{},unloadModule:function(e){try{if(!p.all[e])return this;e=require.resolve(e);var t=require.cache[e];t&&t.parent&&t.parent.children.splice(t.parent.children.indexOf(t),1),require.cache[e]=null,delete require.cache[e],t=null;var n=p.all[e];n&&n.parent&&p.unloadModule(n.parent.path),p.all[e]=null,delete p.all[e],n=null}catch(e){l.error("Module unloadModule error: ",e.message),console.error(e)}return this},loadModule:function(n,t,r){if(n="/"===u?n.split("\\").join(u):n.split("/").join(u),l.is(n,p))return n.load(t);if("node:"===n.substring(0,5)){var e={};try{e=require(n.substring(5))}catch(e){l.error("node require("+n.substring(5)+") error: ",e.message),console.error(e)}finally{return t(e)}}var a=null;if(l.NODE_PATHS&&l.NODE_PATHS.length&&l.NODE_PATHS.every(function(e,t){return 0!==n.indexOf(e)||(a=n,!1)}),!a&&(a=f.formatPath(n,r),!h))try{a=require.resolve(a,r)}catch(e){return l.error("node require.resolve("+a+") error: ",e.message),console.error(e),t({})}var s=p.all[a];s?s.load(t):(s=p.all[a]=new p(a),p.counter++,h?this.__webModule(a,function(e){if(p.counter--,e)throw new Error("Failed to load module:"+n);s.sets({parent:r,path:a,dependencies:p.current.get("dependencies"),factory:p.current.get("factory"),status:i}),s.load(t)}):this.__nodeModule(a,function(e){p.counter--,s.sets({parent:r,path:a,dependencies:p.current.get("dependencies"),factory:p.current.get("factory"),status:i}),s.load(t)}))},__nodeModule:function(e,t){var n=e,r=t||l.idle,a={};try{a=require(n)}catch(e){l.error("node require("+n+") error: ",e.message),console.error(e)}finally{r(a)}},__webModule:function(e,t){function n(e){a.onload=null,a.onerror=null,i(e)}var r=h.head||h.getElementsByTagName("head")[0],a=h.createElement("script"),s=e,i=t||l.idle;s=".js"===(s=s.slice(-1)===u?s+"index.js":s).slice(-3).toLowerCase()?s:s+".js",a.src=s,"onload"in a?a.onload=function(){n(null)}:a.onreadystatechange=function(e){var t=a.readyState;n("loaded"===t||"complete"===t?null:e)},a.onerror=function(e){n(e)},r.appendChild(a)}},properties:{parent:null,status:r,path:"",dependencies:null,factory:null,value:{set:function(e){e._ctors_&&(e.$path=this.get("path")),this._value=e},get:function(){return this._value}}},methods:{init:function(e,t,n){this.sets({path:e,dependencies:t||[],factory:n,value:{}}),this._callbacks=[]},exec:function(e){var t=process.argv[1];return this.sets({path:t,status:i}),this.load(e),this},__pending:function(e){this._callbacks.push(e)},__loading:function(e){this.get("path");var t=this.get("dependencies"),n=this._depHandler,r=this.get("factory"),a=this.get("value");this.set("status",c),this._callbacks.push(e);var s=t.length;if(0===s)a=r.call(a)||a,this.set("value",a),this.set("status",d),l.each(this._callbacks,function(e){e(a)});else{var i=[],o=this;l.each(t,function(e,t){n&&(e=n(e,t)),p.loadModule(e,function(e){i[t]=e,0===--s&&(a=r.apply(a,i)||a,o.set("value",a),o.set("status",d),l.each(o._callbacks,function(e){e(a)}))},o)})}},__waiting:function(e){var t=this;setTimeout(function(){0===p.counter&&t.set("status",i),t.load(e)})},__loaded:function(e){e(this.get("value"))},load:function(e){var t=this.get("status"),n=e||l.idle;switch(t){case r:this.__pending(n);break;case i:this.__loading(n);break;case c:this.__waiting(n);break;case d:this.__loaded(n)}return this}}});l.define=function(){var e=arguments,t=e[0],n=[],r=null;switch(e.length){case 1:r=l.is(t,"function")?t:l.is(t,"array")?(n=t,function(){var t={};return l.each(arguments,function(e){e._name_?t[e._name_]=e:l.extend(t,e)}),t}):function(){return t};break;case 2:case 3:n=t,r=e[1]}return n&&l.is(n,"string")&&(n=[n]),p.current=new p("",n,r),e[2]&&(p.current._depHandler=e[2]),p.current};var e=l.Class("zn.Loader",{static:!0,properties:{preLoadPackages:[]},methods:{init:function(){for(var e=this.preLoadPackages,t=0,n=e.length;t<n;t++)this.loadPackage(e[t])},loadPackage:function(e){this.load(e+"index.js",function(e){l.extend(p.preLoadedPackage,e)})},load:function(e,t,n){return p.loadModule(e,t,n),this}}});l.load=e.load,l.module=p}(zn);